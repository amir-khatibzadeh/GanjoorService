@model GanjooRazor.Pages.LoginPartialEnabledPageModel
@using DNTPersianUtils.Core


<div id="main-navbar" role="navigation">

    <div class="clear-both">
        <div class="float-right display-inline-flex width-76px">
            <a onclick="switchSticky()" role="button" class="cursor-pointer" title="چسبانی">
                <div class="noborder-btn color-white">
                    <svg id="pin_button" class="noindent-info-button" height="24px" viewBox="0 0 24 24" width="24px"><g><rect fill="none" height="24" width="24" /></g><g><path d="M14,4v5c0,1.12,0.37,2.16,1,3H9c0.65-0.86,1-1.9,1-3V4H14 M17,2H7C6.45,2,6,2.45,6,3c0,0.55,0.45,1,1,1c0,0,0,0,0,0l1,0v5 c0,1.66-1.34,3-3,3v2h5.97v7l1,1l1-1v-7H19v-2c0,0,0,0,0,0c-1.66,0-3-1.34-3-3V4l1,0c0,0,0,0,0,0c0.55,0,1-0.45,1-1 C18,2.45,17.55,2,17,2L17,2z" /></g></svg>
                </div>
            </a>

            @if (Model.GanjoorPage != null && Model.GanjoorPage.Poem != null)
            {
                <a onclick="w3_open()" role="button" class="cursor-pointer" title="ابزارها">
                    <div class="noborder-btn color-white">
                        <i class="notranslate noindent-info-button menu-icon mirror spinnerIcon color-yellow"></i>
                    </div>
                </a>
            }
            else
            {
                <a onclick="document.getElementById('navbarhelp').style.display='block'" role="button" class="cursor-pointer" title="راهنما">
                    <div class="noborder-btn color-white">
                        <svg class="noindent-info-button" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none" /><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z" /></svg>
                    </div>
                </a>
            }


        </div>

        @if (Model.LoggedIn)
        {
            <a href="/User" role="button" class="cursor-pointer" title="پیشخان کاربر">
                <div class="circled-number">
                    <i class="notranslate noindent-info-button user-home-icon"></i>
                </div>
            </a>
            <a href="/User/MyBookmarks" role="button" class="cursor-pointer" title="نشان‌شده‌های من">
                <div class="circled-number">
                    <i class="notranslate noindent-info-button bookmarks-icon"></i>
                </div>
            </a>
            <a href="/User/Notifications" role="button" class="w3tooltip cursor-pointer">
                <div class="circled-number">
                    <i class="notranslate noindent-info-button notifications-icon"><span id="notification-badge" class="display-none"></span></i>
                </div>
                <span class="w3tooltiptext">اعلان‌های من</span>
            </a>
            <a href="/User/History" role="button" class="cursor-pointer" title="ادامهٔ مطالعه">
                <div class="circled-number">
                    <i class="notranslate noindent-info-button history-icon"></i>
                </div>
            </a>

            <a href="/login" role="button" class="cursor-pointer" title="خروج">
                <div class="circled-number">
                    <i class="notranslate noindent-info-button logout-icon"></i>
                </div>
            </a>
        }
        else
        {
            <a onclick="document.getElementById('id01').style.display='block'" role="button" class="cursor-pointer pagebutton" style="display:inline-table;border: 3px solid black">
                ورود کاربر / نام‌نویسی <i class="notranslate noindent-info-button account-icon"></i>
            </a>
        }

        <div class="float-left display-inline-flex width-76px">

            <a href="#footer" role="button" class="cursor-pointer" title="پایین صفحه">
                <div class="noborder-btn">
                    <i class="notranslate noindent-info-button down-btn"></i>
                </div>
            </a>

            <a href="#" role="button" class="cursor-pointer" title="بالای صفحه">
                <div class="noborder-btn">
                    <i class="notranslate noindent-info-button up-btn"></i>
                </div>
            </a>

        </div>

    </div>

    @if (Model.GanjoorPage != null && Model.GanjoorPage.Poem != null)
    {
        <div class="clear-both margin-15px" id="main-inline-div" style="display:none">
            <input type="search" name="inline-search" id="inline-search" class="text-align-center" placeholder="جستجو در متن" size="20" value="" onkeyup="inlineHighlight()">
            <a onclick="inlineUnHighlight()" role="button" class="cursor-pointer">
                <i class="notranslate noindent-info-button close-button"></i>
            </a>
            <a onclick="nextInlineSearchResult()" role="button" class="cursor-pointer">
                <i class="notranslate noindent-info-button next-inline-result"></i>
            </a>
            <a onclick="prevInlineSearchResult()" role="button" class="cursor-pointer">
                <i class="notranslate noindent-info-button prev-inline-result"></i>
            </a>
            <div id="inline-search-matches" class="inline-small"></div>
        </div>
    }

</div>


@if (Model.GanjoorPage != null && Model.GanjoorPage.Poem != null)
{

    <div class="w3-sidebar w3-bar-block" style="display:none;z-index:5" id="mySidebar">
        <button class="w3-bar-item w3-button w3-xxlarge sticky sidebar-close" onclick="w3_close()">بستن &times;</button>

        @if (Model.LoggedIn)
        {
           
            <div class="w3-bar-item w3-button">
                <a href="/User/Editor?id=@Model.GanjoorPage.Id" role="button" class="cursor-pointer">
                    <div class="circled-number">
                        <i class="notranslate noindent-info-button edit-poem-button"></i>
                    </div>
                    ویرایش شعر
                </a>
            </div>
        }

      

        <div class="w3-bar-item w3-button">
            <a onclick="copyPoemLink()" role="button" class="cursor-pointer">
                <div class="circled-number">
                    <i class="notranslate noindent-info-button copylink-icon"></i>
                </div>
                <span class="w3tooltiptext">رونوشت نشانی</span>
            </a>
        </div>

        <div class="w3-bar-item w3-button">
            <a onclick="copyPoemText()" role="button" class="cursor-pointer">
                <div class="circled-number">
                    <i class="notranslate noindent-info-button copytext-icon"></i>
                </div>
                <span class="w3tooltiptext">رونوشت متن</span>
            </a>
        </div>

        

        @if (Model.SectionsWithMetreAndRhymes != null)
        {
            @if (Model.SectionsWithMetreAndRhymes.Any())
            {
                <text>
                    <div class="w3-bar-item w3-button">
                        <a href="@Html.Raw($"/simi/?v={Uri.EscapeDataString(Model.SectionsWithMetreAndRhymes.First().GanjoorMetre.Rhythm)}&amp;g={Uri.EscapeDataString(Model.SectionsWithMetreAndRhymes.First().RhymeLetters)}")" role="button" class="cursor-pointer">
                            <div class="circled-number">
                                <i class="notranslate noindent-info-button rhyming-poems"></i>
                            </div>
                            مشابه‌یابی بر اساس وزن و قافیه
                        </a>
                    </div>
                </text>

                @for (int nSectionIndex = 1; nSectionIndex < Model.SectionsWithMetreAndRhymes.Count; nSectionIndex++)
                {
                    <div class="w3-bar-item w3-button">
                        <text>
                            <a href="@Html.Raw($"/simi/?v={Uri.EscapeDataString(Model.SectionsWithMetreAndRhymes[nSectionIndex].GanjoorMetre.Rhythm)}&amp;g={Uri.EscapeDataString(Model.SectionsWithMetreAndRhymes[nSectionIndex].RhymeLetters)}")" role="button" class="cursor-pointer">
                                <div class="circled-number">
                                    <i class="notranslate noindent-info-button rhyming-poems"></i>
                                </div>
                                موارد هم آهنگ (وزن @((nSectionIndex + 1).ToPersianNumbers()))
                            </a>
                        </text>
                    </div>
                }
            }
        }


        <div class="w3-bar-item w3-button">
            <a onclick="w3_close()" href="#tools" role="button" class="cursor-pointer">
                <div class="circled-number">
                    <i class="notranslate noindent-info-button menu-icon"></i>
                </div>
                اطلاعات شعر
            </a>
        </div>


        <div class="w3-bar-item w3-button">
            <a onclick="w3_close()" href="#discussions" role="button" class="cursor-pointer">
                <div class="circled-number">
                    <i class="notranslate noindent-info-button recitation-comments"></i>
                </div>
                حاشیه‌های شعر
            </a>
        </div>

        <div class="w3-bar-item w3-button">
            <a onclick="w3_close()" href="#manuscripts" role="button" class="cursor-pointer">
                <div class="circled-number">
                    <i class="notranslate noindent-info-button recitation-manuscripts"></i>
                </div>
                تصاویر نسخه‌های خطی و چاپی
            </a>
        </div>

        <div class="w3-bar-item w3-button">
            <a onclick="w3_close()" href="#songs" role="button" class="cursor-pointer">
                <div class="circled-number">
                    <i class="notranslate noindent-info-button recitation-music"></i>
                </div>
                آهنگ‌های مرتبط با شعر
            </a>
        </div>

        @if (Model.SectionsWithRelated.Count > 0)
        {
            <div class="w3-bar-item w3-button">
                <a onclick="w3_close()" href="#rpoems" role="button" class="cursor-pointer">
                    <div class="circled-number">
                        <i class="notranslate noindent-info-button balance"></i>
                    </div>
                    شعرهای هم‌وزن و هم‌قافیه
                </a>
            </div>
        }

        @if (Model.GanjoorPage.Poem.Recitations.Where(a => a.RecitationType == RMuseum.Models.GanjoorAudio.RecitationType.Normal).Any())
        {
            <div class="w3-bar-item w3-button">
                <a onclick="w3_close()" href="#recitations" role="button" class="cursor-pointer">
                    <div class="circled-number">
                        <i class="notranslate noindent-info-button recitation-listen"></i>
                    </div>
                    روخوانی‌های شعر
                </a>
            </div>
        }

        @if (Model.GanjoorPage.Poem.Recitations.Where(a => a.RecitationType == RMuseum.Models.GanjoorAudio.RecitationType.Commentary).Any())
        {
            <div class="w3-bar-item w3-button">
                <a onclick="w3_close()" href="#commentaries" role="button" class="cursor-pointer">
                    <div class="circled-number">
                        <i class="notranslate noindent-info-button commentary-listen"></i>
                    </div>
                    شرح‌های صوتی
                </a>
            </div>
        }

        @if (Model.GanjoorPage.Poem.Recitations.Any())
        {
            
            <div class="w3-bar-item w3-button">
                <a onclick="switchPlayerScrollLock()" role="button" class="cursor-pointer">
                    <div class="circled-number">
                        <i class="notranslate noindent-info-button recitation-scrollunlock"></i>
                    </div>
                    قفل روی خوانش
                </a>
            </div>
        }


        <div class="w3-bar-item w3-button">
            <a href="/t6e?p=@Model.GanjoorPage.Id" role="button" class="cursor-pointer" target="_blank">
                <div class="circled-number">
                    <i class="notranslate noindent-info-button print"></i>
                </div>
                نمای چاپی‌مانند
            </a>
        </div>

        @if (!string.IsNullOrEmpty(Model.PreviousUrl))
        {
            <div class="w3-bar-item w3-button">
                <a href="@Html.Raw(Model.PreviousUrl)" role="button" class="cursor-pointer">
                    <div class="circled-number">
                        <i class="notranslate noindent-info-button right-btn"></i>
                    </div>
                    شعر قبلی
                </a>
            </div>
        }

        @if (!string.IsNullOrEmpty(Model.NextUrl))
        {
            <div class="w3-bar-item w3-button">
                <a href="@Html.Raw(Model.NextUrl)" role="button" class="w3tooltip cursor-pointer">
                    <div class="circled-number">
                        <i class="notranslate noindent-info-button left-btn"></i>
                    </div>
                    شعر بعدی
                </a>
            </div>
        }

        <div class="w3-bar-item w3-button">
            <a onclick="w3_close_showHelp();" role="button" class="cursor-pointer">
                <div class="circled-number">
                    <i class="notranslate noindent-info-button help-button mirror"></i>
                </div>
                راهنمای سریع
            </a>
        </div>


        

    </div>


}

@if (Model.LoggedIn)
{
    <script>
        CheckIfHasNotificationsForHomePage();
    </script>
}
else
{
    <!-- The Modal -->
    <div id="id01" class="modal">
        <span onclick="document.getElementById('id01').style.display='none'"
          class="close" title="بستن">&times;</span>

        <!-- Modal Content -->
        <form class="modal-content animate" method="post" action="?handler=Login">
            <div class="imgcontainer">
                <img src="/image/login.png" alt="گنجور" class="avatar">
            </div>
            <table style="width:100%">
                <tr>
                    <td colspan="2">
                        <h2>
                            ورود به گنجور
                        </h2>
                    </td>
                </tr>
                <tr>
                    <td>
                        <span class="inputlabel">پست الکترونیکی: </span>
                    </td>
                    <td>
                        <input type="email" style="text-align:left;direction:ltr;width:100%" placeholder="پست الکترونیکی" asp-for="LoginViewModel.Username">
                    </td>
                </tr>
                <tr>
                    <td>
                        <span class="inputlabel">گذرواژه: </span>
                    </td>
                    <td>
                        <input type="password" id="password" style="text-align:left;direction:ltr;width:100%" placeholder="گذرواژه" asp-for="LoginViewModel.Password">
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td><input type="submit" name="submit" style="width:100%;cursor:pointer" id="submit" value="ورود"></td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <table style="width:100%; margin:0">
                            <tr>
                                <td>
                                    <input type="button" onclick="location.href='/signup'" class="cancelbtn" style="width:100%;text-align:center;cursor:pointer" value="نام‌نویسی">
                                </td>
                                <td>
                                    <input type="button" onclick="location.href='/resetpassword'" class="cancelbtn" style="width:100%;text-align:center;cursor:pointer" value="فراموشی گذرواژه">
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <input type="button" onclick="document.getElementById('id01').style.display='none'" style="width: 100%; text-align: center; cursor: pointer" value="انصراف">
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <p>
                            اگر پیش‌تر در <a href="https://museum.ganjoor.net" target="_blank">گنجینه</a> یا <a href="https://gaudiopanel.ganjoor.net" target="_blank">پیشخان خوانشگران</a> گنجور نام‌نویسی کرده‌اید می‌توانید با همان اطلاعات کاربری به گنجور وارد شوید.
                        </p>
                    </td>
                </tr>

            </table>

        </form>

    </div>
}

<div id="navbarhelp" class="modal">
    <span onclick="document.getElementById('navbarhelp').style.display='none'"
          class="close red-color" title="بستن">&times;</span>

    <!-- Modal Content -->
    <div class="modal-content animate">
        <table class="width-100per">
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button pin-button"></i>
                    </div>
                </td>
                <td>
                    غیرفعال و فعال کردن دوبارهٔ حالت چسبانی نوار ابزار به بالای صفحات
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button help-button mirror"></i>
                    </div>
                </td>
                <td>
                    راهنمای نوار ابزار
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button user-home-icon"></i>
                    </div>
                </td>
                <td>
                    پیشخان کاربر
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button bookmarks-icon"></i>
                    </div>
                </td>
                <td>
                    اشعار و ابیات نشان‌شدهٔ کاربر
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button notifications-icon"></i>
                    </div>
                </td>
                <td>
                    اعلان‌های کاربر
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button history-icon"></i>
                    </div>
                </td>
                <td>
                    ادامهٔ مطالعه (تاریخچه)
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button logout-icon"></i>
                    </div>
                </td>
                <td>
                    خروج از حساب کاربری گنجور
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button down-btn"></i>
                    </div>
                </td>
                <td>
                    لغزش به پایین صفحه
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button up-btn"></i>
                    </div>
                </td>
                <td>
                    لغزش به بالای صفحه
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button menu-icon"></i>
                    </div>
                </td>
                <td>
                    لغزش به بخش اطلاعات شعر
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button recitation-comments"></i>
                    </div>
                </td>
                <td>
                    لغزش به بخش حاشیه‌های شعر
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button menu-book"></i>
                    </div>
                </td>
                <td>
                    لغزش به بخش تصاویر نسخه‌های خطی، چاپی و نگاره‌های هنری مرتبط با شعر
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button recitation-music"></i>
                    </div>
                </td>
                <td>
                    لغزش به بخش ترانه‌ها و قطعات موسیقی مرتبط با شعر
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button balance"></i>
                    </div>
                </td>
                <td>
                    لغزش به بخش شعرهای هم‌آهنگ
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button recitation-listen"></i>
                    </div>
                </td>
                <td>
                    لغزش به بخش خوانش‌های شعر
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button commentary-listen"></i>
                    </div>
                </td>
                <td>
                    لغزش به بخش شرح‌های صوتی
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button recitation-scrollunlock"></i>
                    </div>
                </td>
                <td>
                    فعال یا غیرفعال کردن لغزش خودکار به خط مرتبط با محل فعلی خوانش
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button format_list_numbered_rtl"></i>
                    </div>
                </td>
                <td>
                    فعال یا غیرفعال کردن شماره‌گذاری خطوط
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button copylink-icon"></i>
                    </div>
                </td>
                <td>
                    کپی نشانی شعر جاری در گنجور
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button copytext-icon"></i>
                    </div>
                </td>
                <td>
                    کپی متن شعر جاری در گنجور
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button share-icon"></i>
                    </div>
                </td>
                <td>
                    به اشتراک‌گذاری متن شعر جاری در گنجور
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button rhyming-poems"></i>
                    </div>
                </td>
                <td>
                    مشابه‌یابی شعر جاری در گنجور بر اساس وزن و قافیه
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button menu-book"></i>
                    </div>
                </td>
                <td>
                    مشاهدهٔ شعر مطابق قالب‌بندی کتاب‌های قدیمی (فقط روی مرورگرهای رومیزی یا دستگاه‌های با عرض مناسب)
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button bookmarking-icon"></i>
                    </div>
                </td>
                <td>
                    نشان کردن شعر جاری
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button edit-poem-button"></i>
                    </div>
                </td>
                <td>
                    ویرایش شعر جاری
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button edit-note-poem-button"></i>
                    </div>
                </td>
                <td>
                    ویرایش خلاصه یا برگردان نثر سادهٔ ابیات شعر جاری
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button right-btn"></i>
                    </div>
                </td>
                <td>
                    شعر یا بخش قبلی
                </td>
            </tr>
            <tr>
                <td>
                    <div class="navbar-help-button">
                        <i class="notranslate noindent-info-button left-btn"></i>
                    </div>
                </td>
                <td>
                    شعر یا بخش بعدی
                </td>
            </tr>
        </table>

    </div>

</div>

@if (Model.LoggedIn && Model.GanjoorPage != null && Model.GanjoorPage.Poem != null)
{
    <div id="bookmark-note-dialog" class="modal">
        <span onclick="document.getElementById('bookmark-note-dialog').style.display='none'"
          class="close" title="بستن">&times;</span>
        <form class="modal-content animate" method="post" id="editnoteform">
            <table class="max-width-100per width-100per">
                <tr>
                    <td>
                        <textarea name="editNoteText" id="editNoteText" class="inputTextarea editor width-100per" tabindex="4" rows="10"></textarea>
                        <input type="hidden" name="editbookmarkId" id="editbookmarkId" value="">
                    </td>
                </tr>
                <tr>
                    <td>
                        <button name="editnote" id="editnote" class="editor-button background-green margin-top-5px" onclick="return savePrivateNote();">ذخیرهٔ یادداشت برای نشان‌شده</button>
                    </td>
                </tr>
                <tr>
                    <td>
                        <a role="button" class="editor-button background-gray margin-top-5px" onclick="document.getElementById('bookmark-note-dialog').style.display='none'">بدون یادداشت</a>
                    </td>
                </tr>
                <tr>
                    <td>
                        یادداشتهایی که روی نشان‌شده‌ها می‌نویسید خصوصی هستند، در پیشخان کاربر بخش نشان‌شده‌های من قابل مشاهده‌اند و با حذف نشان بدون هیچ اخطاری پاک می‌شوند.
                    </td>
                </tr>
            </table>
        </form>
    </div>
}
